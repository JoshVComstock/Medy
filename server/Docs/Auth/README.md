# Documentación ERP Auth
## Base de datos

>[!NOTE]
>El gestor utilizado es PostgreSQL

La tabla de la base de datos que contiene los usuarios se llama `RecUsuario` contiene las siguientes columnas:

- `Id` (int): El ID único de la tabla
- `IdTipoUsuario` (int): El ID del tipo del usuario
- `IdEmpresa` (int): El ID de empresa a la que pertenece ese usuario
- `IdContacto` (int): El ID de contacto del usuario
- `IdAccion` (int): ???
- `Telefono` (string): El teléfono del usuario
- `Login` (string): El nombre de usuario utilizado para la autenticación
- `Password` (string): La contraseña encriptada del usuario
- `CodigoSecreto` (string | null): ???
- `Firma` (string | null): La firma del usuario
- `Notificación` (string | null): Notificación para el usuario
- `EstadoBot` (string | null): ???
- `CodigoBot` (string | null): ???
- `Activo` (boolean): El estado del usuario
- `Estado` ("AC" | "EL"): El estado de la tupla
- `IdUsrCreacion` (int): El usuario creador de la tupla
- `IdUsrModificacion` (int): El último usuario que modificó la tupla

El script para crear la tabla en la base de datos

```sql
CREATE TABLE public."RecUsuario" (
    "Id" integer NOT NULL,
    "IdTipoUsuario" integer NOT NULL,
    "IdEmpresa" integer NOT NULL,
    "IdContacto" integer NOT NULL,
    "IdAccion" integer NOT NULL,
    "IdUsrCreacion" integer NOT NULL,
    "IdUsrModificacion" integer NOT NULL,
    "Telefono" text NOT NULL,
    "Login" text NOT NULL,
    "Password" text NOT NULL,
    "CodigoSecreto" text,
    "Firma" text,
    "Notificacion" text,
    "EstadoBot" text,
    "CodigoBot" text,
    "Activo" boolean NOT NULL,
    "Estado" text NOT NULL
);

ALTER TABLE public."RecUsuario" ALTER COLUMN "Id" ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."RecUsuario_Id_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);

ALTER TABLE ONLY public."RecUsuario"
    ADD CONSTRAINT "PK_RecUsuario" PRIMARY KEY ("Id");
```

## Endpoints

>[!TIP]
>Las rutas que requieren token necesitan recibir el token secreto a través de la cabecera `Authorization` con el valor de `Bearer TOKEN_SECRETO`,
>de lo contrario el servidor responderá con estado 401

Una mayoría de las respuestas contiene los datos del usuario en el siguiente formato:
```json
  {
    "id": 3,
    "idTipoUsuario": 1,
    "idEmpresa": 1,
    "idContacto": 1,
    "idAccion": 1,
    "idUsrCreacion": 1,
    "idUsrModificacion": 1,
    "telefono": "12345678",
    "login": "string",
    "password": "$2b$10$SbeFHglc8MiHx6xMGSEP1Ojew8HdvO1EAZ1/bE/fkMX47uok2JG3e",
    "codigoSecreto": null,
    "firma": null,
    "notificacion": null,
    "estadoBot": null,
    "codigoBot": null,
    "activo": true,
    "estado": "AC"
  }
```

# Registro
- Ruta: `/auth/register`
- Método: `POST`
- Requiere token: `NO`
- Body: 
```json
    {
      "login": "string",
      "password": "string",
      "telefono": "+591 12345678"
    }
```
- Respuesta:
```json
  {
    "message": "Usuario registrado correctamente",
    "status": 200,
    "data": DATOS DEL USUARIO REGISTRADO
  }
```

# Inicio de sesión
- Ruta: `/auth/login`
- Método: `POST`
- Requiere token: `NO`
- Body: 
```json
  {
    "username": "string",
    "password": "string"
  }
```
- Respuesta:
```json
  {
    "message": "Usuario obtenido correctamente",
    "status": 200,
    "data": "TOKEN_SECRETO"
  }
```

# Obtener datos del usuario
- Ruta: `/auth/me`
- Método: `GET`
- Requiere token: `SI`
- Respuesta:
```json
  {
    "message": "Usuario obtenido correctamente",
    "status": 200,
    "data": DATOS DEL USUARIO
  }
```

# Modificar mis datos de usuario
- Ruta: `/auth/user`
- Método: `PUT`
- Requiere token: `SI`
- Body: 
```json
  {
    "login": "string",
    "telefono": "+591 12345678"
  }
```
- Respuesta:
```json
  {
    "message": "Usuario actualizado exitosamente",
    "status": 200,
    "data": DATOS DEL USUARIO ACTUALIZADOS
  }
```

# Modificar mi contraseña
- Ruta: `/auth/password`
- Método: `POST`
- Requiere token: `SI`
- Body: 
```json
  {
    "actual":"string",
    "nueva":"123456",
    "confirmar":"123456"
  }
```
- Respuesta:
```json
  {
    "message": "Contraseña actualizada exitosamente",
    "status": 200,
    "data": DATOS DEL USUARIO ACTUALIZADOS
  }
```
